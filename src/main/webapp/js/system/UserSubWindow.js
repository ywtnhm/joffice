UserSubWindow=Ext.extend(Ext.Window,{constructor:function(a){Ext.apply(this,a);this.initUICmps();UserSubWindow.superclass.constructor.call(this,{title:"用户"+a.username+"下属信息",modal:true,iconCls:"menu-subuser",maximizable:true,buttonAlign:"center",width:680,height:400,layout:"border",items:[this.searchPanel,this.southPanel,this.rightPanel],buttons:[{text:"保存",iconCls:"btn-save",scope:this,handler:this.save},{text:"取消",iconCls:"btn-cancel",scope:this,handler:function(){this.close();}}]});},save:function(){var f=this;var g=Ext.getCmp("rightPanel");var c=this.userId;var a=g.getStore();var e=a.getCount();var d="";for(var b=0;b<e;b++){if(b>0){d+=",";}d+=a.getAt(b).data.userId;}$request({url:__ctxPath+"/system/addMyUserSub.do",params:{userId:c,subUserIds:d},success:function(h,i){Ext.ux.Toast.msg("操作信息","成功保存信息");f.close();}});},search:function(){var a=this.searchPanel;var d=Ext.getCmp("leftPanel");var b=d.getStore();var e=Ext.Ajax.serializeForm(a.getForm().getEl());var c=Ext.urlDecode(e);c.start=0;c.limit=b.baseParams.limit;c.userId=this.userId;b.baseParams=c;d.getBottomToolbar().moveFirst();},addAll:function(){var h=Ext.getCmp("leftPanel");var f=Ext.getCmp("rightPanel");var b=f.getStore();var k=h.getSelectionModel().getSelections();for(var c=0;c<k.length;c++){var d=k[c].data.userId;var g=false;for(var a=0;a<b.getCount();a++){if(b.getAt(a).data.userId==d){g=true;break;}}if(!g){var e=new b.recordType(k[c].data);f.stopEditing();b.add(e);}}for(var a=k.length-1;a>=0;a--){h.stopEditing();h.getStore().remove(k[a]);}},removeAll:function(){var k=Ext.getCmp("leftPanel");var a=k.getStore();var g=Ext.getCmp("rightPanel");var c=g.getStore();var l=g.getSelectionModel().getSelections();for(var d=0;d<l.length;d++){var e=l[d].data.userId;var h=false;for(var b=0;b<a.getCount();b++){if(a.getAt(b).data.userId==e){h=true;break;}}if(!h){var f=new a.recordType(l[d].data);k.stopEditing();a.add(f);}}for(var b=l.length-1;b>=0;b--){g.stopEditing();c.remove(l[b]);}},initUICmps:function(){this.searchPanel=new Ext.FormPanel({height:38,region:"north",layout:"hbox",bodyStyle:"padding:6px 2px 2px 2px",layoutConfigs:{align:"middle"},defaultType:"label",defaults:{margins:"0 4 0 4"},items:[{text:"请输入查询条件:名字"},{xtype:"textfield",name:"Q_fullname_S_LK"},{xtype:"button",text:"查询",iconCls:"btn-search",scope:this,handler:this.search}]});var b=new Ext.data.JsonStore({url:__ctxPath+"/system/myUserSub.do",root:"result",totalProperty:"totalCounts",baseParams:{userId:this.userId},remoteSort:true,fields:[{name:"userId",type:"int"},"fullname","title"]});b.load();var f=new Ext.grid.CheckboxSelectionModel();var a=new Ext.grid.ColumnModel({columns:[f,new Ext.grid.RowNumberer(),{header:"姓名",dataIndex:"fullname",renderer:function(i,h,g){var j=g.data.title;if(j==1){return'<img src="'+__ctxPath+'/images/flag/man.png"/>&nbsp;'+i;}else{return'<img src="'+__ctxPath+'/images/flag/women.png"/>&nbsp;'+i;}}}]});var d=new Ext.data.JsonStore({url:__ctxPath+"/system/listAppUser.do",root:"result",totalProperty:"totalCounts",baseParams:{userId:this.userId,start:0,limit:25},remoteSort:true,fields:[{name:"userId",type:"int"},"fullname","title"]});d.load();var e=new Ext.grid.CheckboxSelectionModel();var c=new Ext.grid.EditorGridPanel({id:"leftPanel",region:"center",title:"可选用户列表",height:370,width:400,autoWidth:false,store:d,shim:true,trackMouseOver:true,disableSelection:false,loadMask:true,cm:a,sm:f,viewConfig:{forceFit:true,enableRowBody:false,showPreview:false},bbar:new Ext.PagingToolbar({pageSize:25,store:d,displayInfo:true,displayMsg:"当前显示从{0}至{1}， 共{2}条记录",emptyMsg:"当前没有记录"})});this.rightPanel=new Ext.grid.EditorGridPanel({title:"我的下属",autoScroll:true,id:"rightPanel",region:"east",height:400,width:220,autoScroll:true,store:b,trackMouseOver:true,sm:e,columns:[f,new Ext.grid.RowNumberer(),{header:"用户名",dataIndex:"fullname",width:200,renderer:function(h,i,g){var j=g.data.title;if(j==1){return'<img src="'+__ctxPath+'/images/flag/man.png"/>&nbsp;'+h;}else{return'<img src="'+__ctxPath+'/images/flag/women.png"/>&nbsp;'+h;}},width:60}]});this.southPanel=new Ext.Panel({width:50,region:"center",layout:"border",border:false,items:[new Ext.Panel({width:35,height:430,region:"east",layout:{type:"vbox",pack:"center",align:"stretch"},defaults:{margins:"0 0 5 0"},items:[{xtype:"button",iconCls:"add-all",text:"",scope:this,handler:this.addAll},{xtype:"button",text:"",iconCls:"rem-all",handler:this.removeAll}]}),c]});}});