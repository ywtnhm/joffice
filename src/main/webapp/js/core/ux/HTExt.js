Ext.ns("HT");Ext.ns("HT.ux.plugins");function $getGdSelectedIds(grid,idName){var selRs=grid.getSelectionModel().getSelections();var ids=Array();for(var i=0;i<selRs.length;i++){ids.push(eval("selRs[i].data."+idName));}return ids;}function $postDel(a){Ext.Msg.confirm("信息确认","您确认要删除所选记录吗？",function(b){if(b=="yes"){Ext.Ajax.request({url:a.url,params:{ids:a.ids},method:"POST",success:function(c,d){Ext.ux.Toast.msg("操作信息","成功删除该记录！");if(a.callback){a.callback.call(this);return;}if(a.grid){a.grid.getStore().reload();}},failure:function(c,d){Ext.ux.Toast.msg("操作信息","操作出错，请联系管理员！");}});}});}function $postForm(a){if(a.formPanel.getForm().isValid()){a.formPanel.getForm().submit({scope:a.scope?a.scope:this,url:a.url,method:"post",waitMsg:"正在提交数据...",success:function(b,c){Ext.ux.Toast.msg("操作信息","成功信息保存！");if(a.callback){a.callback.call(this,b,c);}},failure:function(b,c){Ext.MessageBox.show({title:"操作信息",msg:"信息保存出错，请联系管理员！",buttons:Ext.MessageBox.OK,icon:"ext-mb-error"});if(a.callback){a.callback.call(this);}}});}}function $delGridRs(a){var b=$getGdSelectedIds(a.grid,a.idName);if(b.length==0){Ext.ux.Toast.msg("操作信息","请选择要删除的记录！");return;}var c={url:a.url,ids:b,grid:a.grid};$postDel(c);}function $search(d){var a=d.searchPanel;var e=d.gridPanel;if(a.getForm().isValid()){var b=e.getStore();var f=Ext.Ajax.serializeForm(a.getForm().getEl());var c=Ext.urlDecode(f);c.start=0;c.limit=b.baseParams.limit;b.baseParams=c;e.getBottomToolbar().moveFirst();}}HT.SearchPanel=Ext.extend(Ext.form.FormPanel,{constructor:function(b){var f=b.colNums?b.colNums:1;Ext.apply(this,b);if(f>1&&b.items){this.items=[];var e=null;var a=0;for(var c=0;c<b.items.length;c++){var d=b.items[c];if(d.xtype!="hidden"){if(a%f==0){e={xtype:"compositefield",fieldLabel:d.fieldLabel,items:[]};this.items.push(e);}else{e.items.push({xtype:"label",text:d.fieldLabel});}e.items.push(d);a++;}else{this.items.push(d);}}}HT.SearchPanel.superclass.constructor.call(this,{autoHeight:true,border:false,style:"padding:6px;background-color: white",buttonAlign:"center"});}});DicCombo=Ext.extend(Ext.form.ComboBox,{constructor:function(a){Ext.apply(this,a);var b=this.itemName;DicCombo.superclass.constructor.call(this,{triggerAction:"all",store:new Ext.data.ArrayStore({autoLoad:true,baseParams:{itemName:b},url:__ctxPath+"/system/loadItemDictionary.do",fields:["itemId","itemName"]}),displayField:"itemName",valueField:"itemId"});}});Ext.reg("diccombo",DicCombo);HT.ux.plugins.Export=Ext.extend(Object,{constructor:function(a){Ext.apply(this,a);HT.ux.plugins.Export.superclass.constructor.call(this,a);},init:function(b){var a=new Ext.SplitButton({text:"导出",iconCls:"btn-export",menu:new Ext.menu.Menu({items:[{text:"导出当前页EXCEL",iconCls:"btn-export-excel",handler:function(){}},{text:"导出全部记录EXCEL",iconCls:"btn-export-excel",handler:function(){}},"-",{text:"导出当前页PDF",iconCls:"btn-export-pdf",handler:function(){}},{text:"导出全部记录PDF",iconCls:"btn-export-pdf",handler:function(){}}]})});b.add("->");b.add("-");b.add(a);b.add("-");b.on({beforedestroy:function(){a.destroy();}});}});HT.PagingBar=Ext.extend(Ext.PagingToolbar,{constructor:function(b){var a={pageSize:b.store.baseParams.limit?b.store.baseParams.limit:25,displayInfo:true,displayMsg:"当前显示从{0}至{1}， 共{2}条记录",emptyMsg:"当前没有记录",plugins:[new Ext.ux.plugins.PageComboResizer()]};Ext.apply(a,b);HT.PagingBar.superclass.constructor.call(this,a);}});HT.JsonStore=Ext.extend(Ext.data.JsonStore,{constructor:function(a){var b={baseParams:{start:0,limit:25},root:"result",totalProperty:"totalCounts",remoteSort:true};Ext.applyIf(b,a);HT.JsonStore.superclass.constructor.call(this,b);}});HT.GridPanel=Ext.extend(Ext.grid.GridPanel,{constructor:function(a){if(!a.store){this.store=new HT.JsonStore({url:a.url,fields:a.fields});this.store.load();}else{this.store=a.store;}this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:a.singleSelect?a.singleSelect:false});if(a.columns){a.columns.unshift(this.sm);a.columns.unshift(new Ext.grid.RowNumberer());this.columns=a.columns;}else{this.columns=[this.sm,new Ext.grid.RowNumberer()];}if(!a.tbar){a.tbar=new Ext.Toolbar();}this.cm=new Ext.grid.ColumnModel({columns:this.columns,defaults:{sortable:true,menuDisabled:false,width:100}});if(a.rowActions){var c=a.columns[a.columns.length-1];this.plugins=c;}var b={shim:true,trackMouseOver:true,disableSelection:false,loadMask:true,stripeRows:true,autoHeight:true,viewConfig:{forceFit:true,enableRowBody:false,showPreview:false},bbar:new HT.PagingBar({store:this.store})};Ext.apply(b,a);HT.GridPanel.superclass.constructor.call(this,b);}});Ext.reg("htgrid",HT.GridPanel);HT.FormPanel=Ext.extend(Ext.form.FormPanel,{constructor:function(a){var b={layout:"form",bodyStyle:"padding:5px",defaults:{anchor:"100%,100%"},defaultType:"textfield",border:false};Ext.apply(b,a);HT.FormPanel.superclass.constructor.call(this,b);}});Ext.override(Ext.Panel,{loadData:function(conf){var ct=this;var setByName=function(container,data){var items=container.items;if(items!=null){for(var i=0;i<items.getCount();i++){var comp=items.get(i);if(comp.items&&comp.getXType()!="checkboxgroup"){setByName(comp,data);continue;}var xtype=comp.getXType();try{if(xtype=="textfield"||xtype=="textarea"||xtype=="radio"||xtype=="checkbox"||xtype=="datefield"||xtype=="combo"||xtype=="hidden"||xtype=="datetimefield"||xtype=="htmleditor"||xtype=="numberfield"||xtype=="diccombo"||xtype=="displayfield"||xtype=="fckeditor"){var name=comp.getName();if(name){if(conf.preName){if(name.indexOf(conf.preName)!=-1){name=name.substring(conf.preName.length+1);}}var val=eval("data."+name);if(val!=null&&val!=undefined){comp.setValue(val);}}}}catch(e){}}}};if(!ct.loadMask){ct.loadMask=new Ext.LoadMask(Ext.getBody());ct.loadMask.show();}Ext.Ajax.request({method:"POST",params:conf.params,url:conf.url,scope:this,success:function(response,options){var json=Ext.util.JSON.decode(response.responseText);var data=null;if(conf.root){data=eval("json."+conf.root);}else{data=json;}setByName(ct,data);if(ct.loadMask){ct.loadMask.hide();ct.loadMask=null;}if(conf.success){conf.success.call(ct,response,options);}},failure:function(response,options){if(ct.loadMask){ct.loadMask.hide();ct.loadMask=null;}if(conf.failure){conf.failure.call(ct,response,options);}}});}});Ext.form.TextField.prototype.size=20;Ext.form.TextField.prototype.initValue=function(){if(this.value!==undefined){this.setValue(this.value);}else{if(this.el.dom.value.length>0){this.setValue(this.el.dom.value);}}this.el.dom.size=this.size;if(!isNaN(this.maxLength)&&(this.maxLength*1)>0&&(this.maxLength!=Number.MAX_VALUE)){this.el.dom.maxLength=this.maxLength*1;}};